<!DOCTYPE html>
<html>
<!--  -->
<!--  -->
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="bootstrap.min.css">
</head>
<!--  -->
<!--  -->
<body>
	<div class="jumbotron text-center">
		<h1>Welcome to JSql drive</h1>
		<p>Fast relaiable Data-transmission using JS & NoSql database with localstorage  </p> 
	</div>

	
	<div class="container">
		<div class="row">
			<div class="col-sm-6">
				<h1>NewEntry</h1>
				First name:<br>
				<input type="text" id ="first" name="firstname"><br>
				Email:<br>
				<input type="text" id ="email" name="email"><br><br>
				<input type="submit" value="Submit" onclick="updateDB()">
			</div>
			<div class="col-sm-6">
				<h1>Update</h1>
				First name:<br>
				<input type="text" id ="first" name="firstname">
				<br>
				Email:<br>
				<input type="text" id ="email" name="email">
				<br><br>
				<input type="submit" value="Submit" onclick="updateDB()">
			</div>
		</div>
	</div>
	<br><br>
	<div class="container">
	<div class="row">
		<div class="col-sm-6">
			<p>ServerDB at the START</p>
		</div>
		<div class="col-sm-6">
			<input type="button" value="LocalDB" onclick="viewDB()">
		</div>
	</div>
	<div class="row">
		<!-- <p>After Reload</p> -->
		<div class="col-sm-6">
		<table class="table table-striped" id="demo1"></table>
		</div>

		<div class="col-sm-6">
		<table class="table table-striped" id="LocalDBtable"></table>
		</div>
	</div>
	<br><br>
	<div class="row">
		<div class="col-sm-6">
			<button onclick="postDB()">Post</button><br>
		</div>
		<div class="col-sm-6">
			<p id="post"></p>
		</div>
	</div>
		<table class="table table-striped" id="demo2"></table>
	</div>
	</div>


	<div id="demo"></div>
	<div id="demop"></div>
	<p id="msg"></p>

 <script type="text/javascript" src="LocalStorageDB.js"></script>
 <script type="text/javascript">

	//This is where we should GET the data from the server
	var DB = new LocalStorageDB('my_first_database');
	// DB.DROP( 'temp4');
	// DB.DROP( 'temp3')
	// DB.DROP( 'temp2')
	// DB.DROP( 'temp1')
	// DB.DROP( 'temp')
	// DB.DROP( 'my_first_table');
	// DB.DROP( 'my_second_table');
	//DB.DROP('newU');

	function getDB()
	{
		DB.DROP('newU');
		//GET JSON
		// var table=DB.SELECT( 'my_first_table' );

		var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 

		xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				//document.getElementById("demo").innerHTML =
				//this.responseText;
				// console.log(this.responseText);
			var json_input=JSON.parse(this.responseText);
			CreateTableFromJSON(json_input,'demo1')
			//console.log(json_input);
			DB.CREATE( 'newU', {id: 0, name: "DARTH VADER", email: "force@dark.com"},function (a) {
			return {
			email: a.email,
			};});

			DB.INSERT_INTO('newU',json_input);
			console.log(DB.SELECT('newU'));
			}
		};

		//viewDB();

		xmlhttp.open("GET", "http://34.209.252.152/star");
		xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
		xmlhttp.send();

		//viewDB();
	}

	getDB();

	function updateDB()
	{
		var first_name=document.getElementById('first').value;
		var email=document.getElementById('email').value;
		DB.INSERT_INTO( 'newU', [{name:first_name,email:email}] );
		viewDB();
	}

	function viewDB() {
		var table=DB.SELECT( 'newU' );
		CreateTableFromJSON(table, 'LocalDBtable');
	}

	//viewDB();

	function CreateTableFromJSON(table, gid) {
		var myBooks = table;
		// EXTRACT VALUE FOR HTML HEADER. 
		// ('Book ID', 'Book Name', 'Category' and 'Price')
		var col = [];
		for (var i = 0; i < myBooks.length; i++) {
			for (var key in myBooks[i]) {
				if (col.indexOf(key) === -1) {
					col.push(key);
				}
			}
		}
		// CREATE DYNAMIC TABLE.
		var table = document.getElementById(gid);
		table.innerHTML = "";
		//var table = document.createElement("table")
		// CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

		var tr = table.insertRow(-1);                   // TABLE ROW.

		for (var i = 0; i < col.length; i++) {
			var th = document.createElement("th");      // TABLE HEADER.
			th.innerHTML = col[i];
			tr.appendChild(th);
		}

		// ADD JSON DATA TO THE TABLE AS ROWS.
		for (var i = 0; i < myBooks.length; i++) {

			tr = table.insertRow(-1);

			for (var j = 0; j < col.length; j++) {
				var tabCell = tr.insertCell(-1);
				tabCell.innerHTML = myBooks[i][col[j]];
			}
		}
	}

	function postDB()
	{

		// var table=DB.SELECT( 'my_first_table' );

		var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 

		xmlhttp.onreadystatechange = function() {
	
			if (this.readyState == 4 && this.status == 200) {
				document.getElementById("post").innerHTML = "After Post";
				//this.responseText;
				var Jinput = JSON.parse(this.responseText);
				var datastrip = Jinput.result;
				//console.log("enter is fyn")
				CreateTableFromJSON(datastrip,'demo2');
				//console.log("Exit is also is fyn")

			}
		};


		xmlhttp.open("POST", "http://34.209.252.152/star");
		xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
		//console.log(DB.SELECT('newU'));
		xmlhttp.send(JSON.stringify(DB.SELECT('newU')));
		//DB.DROP('newU');
	}
	// window.alert = function(msg){
	//     postDB();
	// }

   
	// window.onunload = confirmExit;
	// function confirmExit(){
	//     var r = confirm("Close?");
	//     if (r == true) {
	//         postDB();
	//         alert("Bye")
	//     }else{
	//         document.getElementById("msg").innerHTML = "Nice Choice!"
	//     }
	//     //return false;
	// }

	//This is where we should POST the data to the server
</script>


</body>
</html>
